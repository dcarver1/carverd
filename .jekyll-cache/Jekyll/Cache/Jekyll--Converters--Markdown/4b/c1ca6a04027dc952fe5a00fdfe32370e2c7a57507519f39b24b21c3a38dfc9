I"î<h1 id="gone-is-forever-deleting-files-in-r">‚ÄúGone is forever‚Äù deleting files in R</h1>

<h2 id="i-need-to-delete-a-lot-of-things">I need to delete a lot of things‚Ä¶</h2>

<p>My top priority project at the moment involves quantifying the conservation status of plants that are the wild relatives of our modern agricultural crops. These Crop Wild Relatives hold a great deal of genetic diversity that can be breed back into agricultural crops to help improve the crop‚Äôs ability to withstand challenging conditions such as drought, cold and heat tolerance, and pest resistance.</p>

<p>If this sounds new and interesting, please check out this <a href="[https://vimeo.com/166853358](https://vimeo.com/166853358)">video</a> by the Crop Trust, which explains the connection between CWRs and modern crops.</p>

<p>My team is currently evaluating the 650 crop wild relatives that are native to the United States. This process involves a lot of input data that is feed into a modeling workflow, which produces a lot of data. The modeling step is an iterative process, meaning there are multiple model runs for each species.</p>

<ul>
  <li>show an example of the folder structure from cmd tree</li>
</ul>

<p><img src="/assests/goneIsForever/folderStructure.png" alt="Large background area" /></p>
<blockquote>
  <p>An example of the file structure created for each species for each model run ~ 11 folders per run</p>
</blockquote>

<p><img src="/assests/goneIsForever/capsicumFiles.png" alt="files" /></p>

<blockquote>
  <p>An example of some of the files created on each run. ~ 52 files per run. This process is then applied to 650 species which generates over 7000 file folders and 33,000 files.</p>
</blockquote>

<p>Because most of these runs are just tests, they eventually need to be deleted. Deleting all the files by hand would be very cumbersome and time-consuming, so I‚Äôm using R to make the computer delete the files for me.</p>

<h2 id="deleting-things-with-r">deleting things with R</h2>

<p>As with most computer-related tasks, with a little bit of time and some digging, I was able to find a way to remove all unnecessary files associated with the older model runs efficiently. I relied on the four base R functions to make it happen: <code class="highlighter-rouge">list.dirs()</code>, <code class="highlighter-rouge">grep()</code>, <code class="highlighter-rouge">list.files()</code>,and <code class="highlighter-rouge">unlink()</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>baseDir &lt;- "D:/cwrNA/gap_analysis"
allFolders &lt;- list.dirs(path = baseDir, full.names = TRUE, recursive = TRUE)
</code></pre></div></div>

<p>I point to the directory where all my files are saved and use <code class="highlighter-rouge">list.dirs()</code> to gather all file paths within the directory.</p>

<blockquote>
  <p>Before deleting old model runs, this directory contain 37,000 sub directories.</p>
</blockquote>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oldFolders &lt;- allFolders[grep(pattern = "test20190827$", x = allFolders)]
</code></pre></div></div>

<p>With this list of files, we use the <code class="highlighter-rouge">grep()</code> function to find all directories that end with ‚Äútest20190827‚Äù. Without the ‚Äú$‚Äù at the end of the pattern, the grep function will return all folders that contain the pattern. As we are just deleting files here, it‚Äôs more efficient to stop at the top directory. If we remove the top directory, we will also capture everything else within it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unlink(x = oldFolders[1],recursive = TRUE)
</code></pre></div></div>

<p>To start, I just wanted to test the process by deleting a single folder. The <code class="highlighter-rouge">recursive=TRUE</code> option forces the <code class="highlighter-rouge">unlink()</code> function to delete file folders. If you are satisfied with the results, you can drop the index and remove all the files.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unlink(x=oldFolders, recursive = TRUE)
</code></pre></div></div>

<p>This process could be done to catch files from a specific run as well. I needed this because some files are saved with <code class="highlighter-rouge">Sys.Date()</code> in the name outside of the folders directories which were deleted.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>allFiles &lt;- list.files(path=baseDir, full.names = TRUE, recursive = TRUE)
#drop the $ because files have extensions
oldFiles &lt;- allFiles[grep(pattern = "2019-08-27", x = allFiles)]
# no need for the recursive option as we are working with files only
unlink(x=oldFiles)
</code></pre></div></div>

<h1 id="deleting-a-lot-of-things-with-r">Deleting a lot of things with R</h1>

<p>While this process is much much faster than manually deleting files, I still have a lot of things to delete. Let‚Äôs say I ran the modeling process four days in a row, but I only need to keep the 4th iteration. We can automate this process a bit more by wrapping the process into a function and rolling it across a list.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># function for deleting a lot of files
deleteALot &lt;- function(directory,pattern){
  allFolders &lt;- list.dirs(path = directory, full.names = TRUE, recursive = TRUE)
  oldFolders &lt;- allFolders[grep(pattern = "test20191206$", x = allFolders)]
  unlink(x = oldFolders, recursive = TRUE)
  print(paste0("All files and folders containing ", pattern, " are gone forever."))
}
# generate a list of patterns
listOfPatterns &lt;- c("test20191206$","test20191207$","test20191208$")

# loop over the patterns and delete A Lot
for(i in listOfPatterns){
  deleteALot(directory = "D:/cwrNA/gap_analysis/temp", pattern = i)
}
</code></pre></div></div>

<h2 id="with-great-power-comes-great-responsibility">With great power comes great responsibility</h2>

<p>I worked with a co-instructor at a summer camp where we could take grade school kids out in canoes and kayaks on lakes. While teaching skills and safety on land, he would frequently tell the kids that ‚ÄúGone is forever.‚Äù A warning that anything the drop beneath the surface of the water was unrecoverable, lost, and completely gone from your life, forever.
It was a dire warning to attempt to create some sense of responsibility in the kids, and the advice applies to this process as well. The <code class="highlighter-rouge">unlink()</code> function does not move items to the recycling bin; it removes them from your computer. They are not coming back. Be cautious and think before you unlink.</p>
:ET